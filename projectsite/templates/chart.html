{% block chart %}
<script>
  // Existing line before modifications remains unchanged
  var lineChart = document.getElementById("lineChart").getContext("2d");
  var barChart = document.getElementById("barChart").getContext("2d");
  var pieChart = document.getElementById("pieChart").getContext("2d");
  var multipleLineChart = document.getElementById("multipleLineChart").getContext("2d");
  var multipleBarChart = document.getElementById("multipleBarChart").getContext("2d");

  // Dynamic Line Chart Implementation
  fetch("/lineChart/")
    .then((response) => response.json())
    .then((result_with_month_names) => {
      var months = Object.keys(result_with_month_names);
      var counts = Object.values(result_with_month_names);

      new Chart(lineChart, {
        type: "line",
        data: {
          labels: months, // Dynamically inserting month names
          datasets: [{
            label: "Active Users",
            borderColor: "#1d7af3",
            pointBorderColor: "#FFF",
            pointBackgroundColor: "#1d7af3",
            pointBorderWidth: 2,
            pointHoverRadius: 4,
            pointHoverBorderWidth: 1,
            pointRadius: 4,
            backgroundColor: "transparent",
            fill: true,
            borderWidth: 2,
            data: counts, // Dynamically inserting user data
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          legend: {
            position: "bottom",
            labels: {
              padding: 10,
              fontColor: "#1d7af3",
            }
          },
          tooltips: {
            bodySpacing: 4,
            mode: "nearest",
            intersect: 0,
            position: "nearest",
            xPadding: 10,
            yPadding: 10,
            caretPadding: 10,
          },
          layout: {
            padding: { left: 15, right: 15, top: 15, bottom: 15 },
          }
        }
      });
    })
    .catch((error) => console.error("Error fetching line chart data:", error));

  // Dynamic Pie Chart Implementation
  fetch("/pieChart/")
    .then((response) => response.json())
    .then((data) => {
      var severityLevels = Object.keys(data);
      var counts = Object.values(data);

      new Chart(pieChart, {
        type: "pie",
        data: {
          datasets: [{
            data: counts,
            backgroundColor: ["#1d7af3", "#f3545d", "#fda94b"],
            borderWidth: 0,
          }],
          labels: severityLevels, // Dynamically inserting severity levels
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          legend: {
            position: "bottom",
            labels: {
              fontColor: "rgb(154, 154, 154)",
              fontSize: 11,
              usePointStyle: true,
              padding: 20,
            }
          },
          pieceLabel: {
            render: "percentage",
            fontColor: "white",
            fontSize: 14,
          },
          tooltips: false,
          layout: {
            padding: { left: 20, right: 20, top: 20, bottom: 20 },
          }
        }
      });
    })
    .catch((error) => console.error("Error fetching pie chart data:", error));

  // Commented out static multiline chart code block
  /*
  var myMultipleLineChart = new Chart(multipleLineChart, {
    type: "line",
    data: {
      labels: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
      datasets: [
        {
          label: "Dataset 1",
          borderColor: "#1d7af3",
          data: [3, 2, 9, 5, 4, 6, 4, 6, 7, 8, 7, 41],
        },
        {
          label: "Dataset 2",
          borderColor: "#f3545d",
          data: [5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16],
        },
      ],
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
    },
  });
  */

  // Dynamic Multiline Chart Implementation
  fetch("/multilineChart/")
    .then((response) => response.json())
    .then((data) => {
      var labels = Object.keys(data); // Extract labels (e.g., months)
      var datasets = [];

      // Process each dataset dynamically
      Object.entries(data).forEach(([label, values], index) => {
        datasets.push({
          label: label,
          borderColor: ["#1d7af3", "#f3545d", "#fda94b", "#50a5d5"][index % 4], // Rotate colors
          data: Object.values(values),
          fill: false,
        });
      });

      new Chart(multipleLineChart, {
        type: "line",
        data: {
          labels: labels, // Dynamically inserting labels
          datasets: datasets, // Dynamically inserting datasets
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          legend: {
            position: "bottom",
            labels: {
              fontColor: "#333",
              fontSize: 12,
            },
          },
          title: {
            display: true,
            text: "Dynamic Multiline Chart",
          },
        },
      });
    })
    .catch((error) => console.error("Error fetching multiline chart data:", error));

  loadCharData();
</script>
{% endblock %}