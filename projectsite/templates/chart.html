{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="page-inner">
    <h4 class="page-title">Chart.js</h4>
    <div class="page-category">
        Simple yet flexible JavaScript charting for designers & developers. Please check out their
        <aa href="https://www.chartjs.org/" target="_blank" rel="noopener noreferrer">full documentation</a>.
    </div>
    <div class="row">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Line Chart</div>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="lineChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Bar Chart</div>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="barChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Pie Chart</div>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="pieChart" style="width: 50%; height: 50%"></canvas>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Doughnut Chart</div>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="doughnutChart" style="width: 50%; height: 50%"></canvas>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Radar Chart</div>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="radarChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Bubble Chart</div>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="bubbleChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Multiple Line Chart</div>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="multipleLineChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Multiple Bar Chart</div>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="multipleBarChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-12">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Chart with HTML Legends</div>
                </div>
                <div class="card-body">
                    <div class="card-sub">
                        Sometimes you need a very complex legend. In these cases, it makes sense to generate an HTML legend. Charts provide a generateLegend() method on their prototype that returns an HTML string for the legend.
                    </div>
                    <div class="chart-container">
                        <canvas id="htmlLegendsChart"></canvas>
                    </div>
                    <div id="myChartLegend"></div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block chart %}
<script>
function loadChartData() {
    // Pie Chart
    fetch("/chart/")
    .then((response) => response.json())
    .then((data) => {
        var severityLevels = Object.keys(data);
        var counts = Object.values(data);
        var pieChart = document.getElementById("pieChart").getContext("2d");
        new Chart(pieChart, {
            type: "pie",
            data: {
                datasets: [{
                    data: counts,
                    backgroundColor: ["#1d7af3", "#f3545d", "#fdaf4b"],
                    borderWidth: 0,
                }],
                labels: severityLevels,
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                legend: {
                    position: "bottom",
                    labels: {
                        fontColor: "rgb(154, 154, 154)",
                        fontSize: 11,
                        usePointStyle: true,
                        padding: 20,
                    },
                },
                pieceLabel: {
                    render: "percentage",
                    fontColor: "white",
                    fontSize: 14,
                },
                tooltips: false,
                layout: {
                    padding: {
                        left: 20,
                        right: 20,
                        top: 20,
                        bottom: 20,
                    },
                },
            },
        });
    })
    .catch((error) => console.error("Error:", error));

    // Line Chart
    fetch("/lineChart/")
    .then((response) => response.json())
    .then((result_with_month_names) => {
        var months = Object.keys(result_with_month_names);
        var counts = Object.values(result_with_month_names);
        var lineChart = document.getElementById("lineChart").getContext("2d");
        new Chart(lineChart, {
            type: "line",
            data: {
                labels: months,
                datasets: [{
                    label: "Active Users",
                    borderColor: "#1d7af3",
                    pointBorderColor: "#FFF",
                    pointBackgroundColor: "#1d7af3",
                    pointBorderWidth: 2,
                    pointHoverRadius: 4,
                    pointHoverBorderWidth: 1,
                    pointRadius: 4,
                    backgroundColor: "transparent",
                    fill: true,
                    borderWidth: 2,
                    data: counts,
                }],
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                legend: {
                    position: "bottom",
                    labels: {
                        padding: 10,
                        fontColor: "#1d7af3",
                    },
                },
                tooltips: {
                    bodySpacing: 4,
                    mode: "nearest",
                    intersect: 0,
                    position: "nearest",
                    xPadding: 10,
                    yPadding: 10,
                    caretPadding: 10,
                },
                layout: {
                    padding: { left: 15, right: 15, top: 15, bottom: 15 },
                },
            },
        });
    })
    .catch((error) => console.error("Error:", error));

    // Multiline Chart
    fetch("/multilineChart/")
    .then((response) => response.json())
    .then((result_with_month_names) => {
        var countries = Object.keys(result_with_month_names);
        var incidentCounts = [];
        var incidentCounts2 = [];
        var incidentCounts3 = [];

        function sortObjectKeys(obj) {
            return Object.keys(obj).sort((a, b) => parseInt(a) - parseInt(b));
        }

        if (countries.length >= 1) {
            var country1_data = result_with_month_names[countries[0]];
            var sortedKeys1 = sortObjectKeys(country1_data);
            incidentCounts = sortedKeys1.map((key) => country1_data[key]);
        }
        if (countries.length >= 2) {
            var country2_data = result_with_month_names[countries[1]];
            var sortedKeys2 = sortObjectKeys(country2_data);
            incidentCounts2 = sortedKeys2.map((key) => country2_data[key]);
        }
        if (countries.length >= 3) {
            var country3_data = result_with_month_names[countries[2]];
            var sortedKeys3 = sortObjectKeys(country3_data);
            incidentCounts3 = sortedKeys3.map((key) => country3_data[key]);
        }

        var multipleLineChart = document.getElementById("multipleLineChart").getContext("2d");
        new Chart(multipleLineChart, {
            type: "line",
            data: {
                labels: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
                datasets: [
                    {
                        label: countries[0],
                        borderColor: "#1d7af3",
                        pointBorderColor: "#FFF",
                        pointBackgroundColor: "#1d7af3",
                        pointBorderWidth: 2,
                        pointHoverRadius: 4,
                        pointHoverBorderWidth: 1,
                        pointRadius: 4,
                        backgroundColor: "transparent",
                        fill: true,
                        borderWidth: 2,
                        data: incidentCounts,
                    },
                    {
                        label: countries[1],
                        borderColor: "#59d05d",
                        pointBorderColor: "#FFF",
                        pointBackgroundColor: "#59d05d",
                        pointBorderWidth: 2,
                        pointHoverRadius: 4,
                        pointHoverBorderWidth: 1,
                        pointRadius: 4,
                        backgroundColor: "transparent",
                        fill: true,
                        borderWidth: 2,
                        data: incidentCounts2,
                    },
                    {
                        label: countries[2],
                        borderColor: "#f3545d",
                        pointBorderColor: "#FFF",
                        pointBackgroundColor: "#f3545d",
                        pointBorderWidth: 2,
                        pointHoverRadius: 4,
                        pointHoverBorderWidth: 1,
                        pointRadius: 4,
                        backgroundColor: "transparent",
                        fill: true,
                        borderWidth: 2,
                        data: incidentCounts3,
                    },
                ],
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                legend: {
                    position: "top",
                },
                tooltips: {
                    bodySpacing: 4,
                    mode: "nearest",
                    intersect: 0,
                    position: "nearest",
                    xPadding: 10,
                    yPadding: 10,
                    caretPadding: 10,
                },
                layout: {
                    padding: { left: 15, right: 15, top: 15, bottom: 15 },
                },
            },
        });
    })
    .catch((error) => console.error("Error:", error));

    // Multibar Chart
    fetch("/multiBarChart/")
    .then((response) => response.json())
    .then((result) => {
        var severitylevel = Object.keys(result);
        var incidentCount_major = [];
        var incidentCounts_minor = [];
        var incidentCounts_moderate = [];

        function sortObjectKeys(obj) {
            return Object.keys(obj).sort((a, b) => parseInt(a) - parseInt(b));
        }

        if (severitylevel.length >= 1) {
            var sl1_data = result[severitylevel[0]];
            var sortedKeys1 = sortObjectKeys(sl1_data);
            incidentCount_major = sortedKeys1.map((key) => sl1_data[key]);
        }
        if (severitylevel.length >= 2) {
            var sl2_data = result[severitylevel[1]];
            var sortedKeys2 = sortObjectKeys(sl2_data);
            incidentCounts_minor = sortedKeys2.map((key) => sl2_data[key]);
        }
        if (severitylevel.length >= 3) {
            var sl3_data = result[severitylevel[2]];
            var sortedKeys3 = sortObjectKeys(sl3_data);
            incidentCounts_moderate = sortedKeys3.map((key) => sl3_data[key]);
        }

        var multipleBarChart = document.getElementById("multipleBarChart").getContext("2d");
        new Chart(multipleBarChart, {
            type: "bar",
            data: {
                labels: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
                datasets: [
                    {
                        label: "Minor Fire",
                        backgroundColor: "#59d05d",
                        borderColor: "#59d05d",
                        data: incidentCounts_minor,
                    },
                    {
                        label: "Moderate Fire",
                        backgroundColor: "#fdaf4b",
                        borderColor: "#fdaf4b",
                        data: incidentCounts_moderate,
                    },
                    {
                        label: "Major Fire",
                        backgroundColor: "#177dff",
                        borderColor: "#177dff",
                        data: incidentCount_major,
                    },
                ],
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                legend: {
                    position: "bottom",
                },
                title: {
                    display: true,
                    text: "Fire Incidents by Severity Level",
                },
                tooltips: {
                    mode: "index",
                    intersect: false,
                },
                scales: {
                    xAxes: [{
                        stacked: true,
                    }],
                    yAxes: [{
                        stacked: true,
                    }],
                },
            },
        });
    })
    .catch((error) => console.error("Error:", error));

    // Bar Chart
    var barChart = document.getElementById('barChart').getContext('2d');
    new Chart(barChart, {
        type: 'bar',
        data: {
            labels: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
            datasets: [{
                label: "Sales",
                backgroundColor: '#177dff',
                borderColor: '#177dff',
                data: [36, 45, 32, 27, 38, 40, 42, 44, 40, 35, 30, 27],
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
        }
    });

    // Doughnut Chart
    var doughnutChart = document.getElementById('doughnutChart').getContext('2d');
    new Chart(doughnutChart, {
        type: 'doughnut',
        data: {
            labels: ["Success", "Pending", "Failed"],
            datasets: [{
                data: [480, 230, 190],
                backgroundColor: ['#177dff','#fdaf4b','#f3545d']
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
        }
    });

    // Radar Chart
    var radarChart = document.getElementById('radarChart').getContext('2d');
    new Chart(radarChart, {
        type: 'radar',
        data: {
            labels: ['Running', 'Swimming', 'Eating', 'Cycling', 'Jumping'],
            datasets: [{
                data: [20, 10, 30, 15, 25],
                borderColor: '#177dff',
                backgroundColor: 'rgba(23, 125, 255, 0.2)'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
        }
    });

    // Bubble Chart
    var bubbleChart = document.getElementById('bubbleChart').getContext('2d');
    new Chart(bubbleChart, {
        type: 'bubble',
        data: {
            datasets: [{
                label: 'First Dataset',
                data: [
                    { x: 20, y: 30, r: 15 },
                    { x: 40, y: 10, r: 10 },
                    { x: 15, y: 37, r: 12 },
                    { x: 32, y: 42, r: 33 }
                ],
                backgroundColor: 'rgba(23, 125, 255, 0.6)'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
        }
    });

    // HTML Legends Chart
    var htmlLegendsChart = document.getElementById('htmlLegendsChart').getContext('2d');
    new Chart(htmlLegendsChart, {
        type: 'line',
        data: {
            labels: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
            datasets: [{
                label: "Sales Stats",
                borderColor: '#177dff',
                pointBackgroundColor: '#177dff',
                data: [20, 30, 15, 45, 35, 55, 40, 60, 75, 65, 80, 70]
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            legend: {
                display: false
            },
        }
    });
}

// Call the function to load chart data
loadChartData();
</script>
{% endblock %}
