{% block chart %}
<script>
  // Existing line before modifications remains unchanged
  var lineChart = document.getElementById("lineChart").getContext("2d");
  var barChart = document.getElementById("barChart").getContext("2d");
  var pieChart = document.getElementById("pieChart").getContext("2d");
  var doughnutChart = document.getElementById("doughnutChart").getContext("2d");
  var radarChart = document.getElementById("radarChart").getContext("2d");
  var bubbleChart = document.getElementById("bubbleChart").getContext("2d");
  var multipleLineChart = document.getElementById("multipleLineChart").getContext("2d");
  var multipleBarChart = document.getElementById("multipleBarChart").getContext("2d");
  var htmlLegendsChart = document.getElementById("htmlLegendsChart").getContext("2d");

  // Dynamic Line Chart Implementation
  fetch("/lineChart/")
    .then((response) => response.json())
    .then((result_with_month_names) => {
      var months = Object.keys(result_with_month_names);
      var counts = Object.values(result_with_month_names);

      new Chart(lineChart, {
        type: "line",
        data: {
          labels: months,  // Dynamically inserting month names
          datasets: [{
            label: "Active Users",
            borderColor: "#1d7af3",
            pointBorderColor: "#FFF",
            pointBackgroundColor: "#1d7af3",
            pointBorderWidth: 2,
            pointHoverRadius: 4,
            pointHoverBorderWidth: 1,
            pointRadius: 4,
            backgroundColor: "transparent",
            fill: true,
            borderWidth: 2,
            data: counts, // Dynamically inserting user data
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          legend: {
            position: "bottom",
            labels: {
              padding: 10,
              fontColor: "#1d7af3",
            }
          },
          tooltips: {
            bodySpacing: 4,
            mode: "nearest",
            intersect: 0,
            position: "nearest",
            xPadding: 10,
            yPadding: 10,
            caretPadding: 10,
          },
          layout: {
            padding: { left: 15, right: 15, top: 15, bottom: 15 },
          }
        }
      });
    })
    .catch((error) => console.error("Error:", error));

  // Bar Chart
  var myBarChart = new Chart(barChart, {
    type: "bar",
    data: {
      labels: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
      datasets: [{
        label: "Sales",
        backgroundColor: "rgb(23, 125, 255)",
        borderColor: "rgb(23, 125, 255)",
        data: [3, 2, 9, 5, 4, 6, 4, 6, 7, 8, 7, 41]
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        yAxes: [{
          ticks: {
            beginAtZero: true
          }
        }]
      }
    }
  });

  // Dynamic Pie Chart Implementation
  var counts = Object.values(data);  // Assuming data is fetched dynamically
  console.log("call");

  new Chart(pieChart, {
    type: "pie",
    data: {
      datasets: [{
        data: counts,
        backgroundColor: ["#1d7af3", "#f3545d", "#fda94b"],
        borderWidth: 0,
      }],
      labels: severitylevels,  // Assuming severitylevels is defined
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      legend: {
        position: "bottom",
        labels: {
          fontColor: "rgb(154, 154, 154)",
          fontSize: 11,
          usePointStyle: true,
          padding: 20,
        }
      },
      pieceLabel: {
        render: "percentage",
        fontColor: "white",
        fontSize: 14,
      },
      tooltips: false,
      layout: {
        padding: { left: 20, right: 20, top: 20, bottom: 20 },
      }
    }
  });

  // Event Listeners for All Charts
  lineChart.canvas.addEventListener("click", function (event) {
    var activePoints = myLineChart.getElementsAtEvent(event);
    if (activePoints.length > 0) {
      var clickedIndex = activePoints[0]._index;
      console.log("You clicked on month: " + myLineChart.data.labels[clickedIndex]);
    }
  });

  barChart.canvas.addEventListener("click", function (event) {
    var activePoints = myBarChart.getElementsAtEvent(event);
    if (activePoints.length > 0) {
      var clickedIndex = activePoints[0]._index;
      console.log("You clicked on the month: " + myBarChart.data.labels[clickedIndex]);
    }
  });

  doughnutChart.canvas.addEventListener("click", function (event) {
    var activePoints = myDoughnutChart.getElementsAtEvent(event);
    if (activePoints.length > 0) {
      var clickedIndex = activePoints[0]._index;
      console.log("You clicked on segment: " + myDoughnutChart.data.labels[clickedIndex]);
    }
  });

  radarChart.canvas.addEventListener("click", function (event) {
    var activePoints = myRadarChart.getElementsAtEvent(event);
    if (activePoints.length > 0) {
      var clickedIndex = activePoints[0]._index;
      console.log("You clicked on category: " + myRadarChart.data.labels[clickedIndex]);
    }
  });

  bubbleChart.canvas.addEventListener("click", function (event) {
    var activePoints = myBubbleChart.getElementsAtEvent(event);
    if (activePoints.length > 0) {
      var clickedIndex = activePoints[0]._index;
      console.log("You clicked on bubble: " + myBubbleChart.data.datasets[0].data[clickedIndex].x + ", " + myBubbleChart.data.datasets[0].data[clickedIndex].y);
    }
  });

  multipleLineChart.canvas.addEventListener("click", function (event) {
    var activePoints = myMultipleLineChart.getElementsAtEvent(event);
    if (activePoints.length > 0) {
      var clickedIndex = activePoints[0]._index;
      console.log("You clicked on date: " + myMultipleLineChart.data.labels[clickedIndex]);
    }
  });

  multipleBarChart.canvas.addEventListener("click", function (event) {
    var activePoints = myMultipleBarChart.getElementsAtEvent(event);
    if (activePoints.length > 0) {
      var clickedIndex = activePoints[0]._index;
      console.log("You clicked on date: " + myMultipleBarChart.data.labels[clickedIndex]);
    }
  });

  htmlLegendsChart.canvas.addEventListener("click", function (event) {
    var activePoints = myHtmlLegendsChart.getElementsAtEvent(event);
    if (activePoints.length > 0) {
      var clickedIndex = activePoints[0]._index;
      console.log("You clicked on legend: " + myHtmlLegendsChart.data.labels[clickedIndex]);
    }
  });

  // Ensure dynamic loading of chart data function
  loadChartData();
</script>
{% endblock %}